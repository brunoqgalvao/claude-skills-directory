{
  "id": "youtube-downloader",
  "name": "youtube-downloader",
  "version": "1.0.0",
  "summary": "Download YouTube videos and HLS streams (m3u8) from platforms like Mux, Vimeo, etc. using yt-dlp and ffmpeg. Use this skill when users request downloading videos, extracting aud...",
  "description": "# YouTube Downloader\n\n## Overview\n\nEnable reliable video and audio downloads from YouTube and HLS streaming platforms (Mux, Vimeo, etc.) using yt-dlp and ffmpeg. This skill provides workflows for:\n- YouTube downloads (up to 4K) using PO token providers or browser cookies\n- HLS stream downloads with authentication headers\n- Handling protected content and troubleshooting common download failures\n\n## When to Use This Skill\n\nThis skill should be invoked when users:\n- Request downloading YouTube videos or playlists\n- Want to extract audio from YouTube videos\n- Experience yt-dlp download failures or limited format availability\n- Need help with format selection or quality options\n- Report only low-quality (360p) formats available\n- Ask about downloading YouTube content in specific quality (1080p, 4K, etc.)\n- Need to convert downloaded WebM videos to MP4 format for wider compatibility\n- Request downloading HLS streams (m3u8) from platforms like Mux, Vimeo, or other streaming services\n- Need to download protected streams that require authentication headers\n\n## Prerequisites\n\n### 1. Verify yt-dlp Installation\n\n```bash\nwhich yt-dlp\nyt-dlp --version\n```\n\nIf not installed or outdated (< 2025.10.22):\n\n```bash\nbrew upgrade yt-dlp  # macOS\n# or\npip install --upgrade yt-dlp  # Cross-platform\n```\n\n**Critical**: Outdated yt-dlp versions cause nsig extraction failures and missing formats.\n\n### 2. Check Current Quality Access\n\nBefore downloading, check available formats:\n\n```bash\nyt-dlp -F \"https://youtu.be/VIDEO_ID\"\n```\n\n**If only format 18 (360p) appears**: PO token provider setup needed for high-quality access.\n\n## High-Quality Download Workflow\n\n### Step 1: Install PO Token Provider (One-time Setup)\n\nFor 1080p/1440p/4K access, install a PO token provider plugin into yt-dlp's Python environment:\n\n```bash\n# Find yt-dlp's Python path\nhead -1 $(which yt-dlp)\n\n# Install plugin (adjust path to match yt-dlp version)\n/opt/homebrew/Cellar/yt-dlp/$(yt-dlp --version)/libexec/bin/python -m pip install bgutil-ytdlp-pot-provider\n```\n\n**Verification**: Run `yt-dlp -F \"VIDEO_URL\"` again. Look for formats 137 (1080p), 271 (1440p), or 313 (4K).\n\nSee `references/po-token-setup.md` for detailed setup instructions and troubleshooting.\n\n### Step 2: Download with Best Quality\n\nOnce PO token provider is installed:\n\n```bash\n# Download best quality up to 1080p\nyt-dlp -f \"bestvideo[height<=1080]+bestaudio/best\" \"VIDEO_URL\"\n\n# Download best available quality (4K if available)\nyt-dlp -f \"bestvideo+bestaudio/best\" \"VIDEO_URL\"\n```\n\n### Step 3: Verify Download Quality\n\n```bash\n# Check video resolution\nffprobe -v error -select_streams v:0 -show_entries stream=width,height,codec_name -of default=noprint_wrappers=1 video.mp4\n```\n\nExpected output for 1080p:\n```\ncodec_name=vp9\nwidth=1920\nheight=1080\n```\n\n## Alternative: Browser Cookies Method\n\nIf PO token provider setup is problematic, use browser cookies:\n\n```bash\n# Firefox\nyt-dlp --cookies-from-browser firefox -f \"bestvideo[height<=1080]+bestaudio/best\" \"VIDEO_URL\"\n\n# Chrome\nyt-dlp --cookies-from-browser chrome -f \"bestvideo[height<=1080]+bestaudio/best\" \"VIDEO_URL\"\n```\n\n**Benefits**: Access to age-restricted and members-only content.\n**Requirement**: Must be logged into YouTube in the specified browser.\n\n## Common Tasks\n\n### Audio-Only Download\n\nExtract audio as MP3:\n\n```bash\nyt-dlp -x --audio-format mp3 \"VIDEO_URL\"\n```\n\n### Custom Output Directory\n\n```bash\nyt-dlp -P ~/Downloads/YouTube \"VIDEO_URL\"\n```\n\n### Download with Subtitles\n\n```bash\nyt-dlp --write-subs --sub-lang en \"VIDEO_URL\"\n```\n\n### Playlist Download\n\n```bash\nyt-dlp -f \"bestvideo[height<=1080]+bestaudio/best\" \"PLAYLIST_URL\"\n```\n\n### Convert WebM to MP4\n\nYouTube high-quality downloads often use WebM format (VP9 codec). Convert to MP4 for wider compatibility:\n\n```bash\n# Check if ffmpeg is installed\nwhich ffmpeg || brew install ffmpeg  # macOS\n\n# Convert WebM to MP4 with good quality settings\nffmpeg -i \"video.webm\" -c:v libx264 -preset medium -crf 23 -c:a aac -b:a 128k \"video.mp4\"\n```\n\n**Parameters explained:**\n- `-c:v libx264`: Use H.264 video codec (widely compatible)\n- `-preset medium`: Balance between encoding speed and file size\n- `-crf 23`: Constant Rate Factor for quality (18-28 range, lower = better quality)\n- `-c:a aac`: Use AAC audio codec\n- `-b:a 128k`: Audio bitrate 128 kbps\n\n**Tip**: Conversion maintains 1080p resolution and provides ~6x encoding speed on modern hardware.\n\n## Troubleshooting Quick Reference\n\n### Only 360p Available (Format 18)\n\n**Cause**: Missing PO token provider or outdated yt-dlp.\n\n**Solution**:\n1. Update yt-dlp: `brew upgrade yt-dlp`\n2. Install PO token provider (see Step 1 above)\n3. Or use browser cookies method\n\n### nsig Extraction Failed\n\n**Symptoms**:\n```\nWARNING: [youtube] nsig extraction failed: Some formats may be missing\n```\n\n**Solution**:\n1. Update yt-dlp to latest version\n2. Install PO token provider\n3. If still failing, use Android client: `yt-dlp --extractor-args \"youtube:player_client=android\" \"VIDEO_URL\"`\n\n### Slow Downloads or Network Errors\n\nFor users in China or behind restrictive proxies:\n- Downloads may be slow due to network conditions\n- Allow sufficient time for completion\n- yt-dlp automatically retries on transient failures\n\n### PO Token Warning (Harmless)\n\n```\nWARNING: android client https formats require a GVS PO Token\n```\n\n**Action**: Ignore if download succeeds. This indicates Android client has limited format access without PO tokens.\n\n## Bundled Script Reference\n\n### scripts/download_video.py\n\nA convenience wrapper that applies Android client workaround by default:\n\n**Basic usage:**\n```bash\nscripts/download_video.py \"VIDEO_URL\"\n```\n\n**Arguments:**\n- `url` - YouTube video URL (required)\n- `-o, --output-dir` - Output directory\n- `-f, --format` - Format specification\n- `-a, --audio-only` - Extract audio as MP3\n- `-F, --list-formats` - List available formats\n- `--no-android-client` - Disable Android client workaround\n\n**Note**: This script uses Android client (360p only without PO tokens). For high quality, use yt-dlp directly with PO token provider.\n\n## Quality Expectations\n\n| Setup | 360p | 720p | 1080p | 1440p | 4K |\n|-------|------|------|-------|-------|-----|\n| No setup (default) | ✗ | ✗ | ✗ | ✗ | ✗ |\n| Android client only | ✓ | ✗ | ✗ | ✗ | ✗ |\n| **PO token provider** | ✓ | ✓ | ✓ | ✓ | ✓ |\n| Browser cookies | ✓ | ✓ | ✓ | ✓ | ✓ |\n\n## HLS Stream Downloads (m3u8)\n\nFor streaming platforms like Mux, Vimeo, and other HLS-based services, use ffmpeg as the primary tool. These streams often require authentication headers that yt-dlp may not handle correctly.\n\n### Identifying HLS Streams\n\nHLS streams use `.m3u8` playlist files:\n- Master playlist: Lists multiple quality options\n- Rendition playlist: Contains actual video/audio segment URLs\n\n### Download Workflow\n\n#### Step 1: Obtain the Stream URL\n\nGet the m3u8 URL from the video source. For protected streams:\n1. Open browser DevTools → Network tab\n2. Play the video\n3. Filter for \"m3u8\" to find the playlist URLs\n4. Copy the rendition URL (usually contains quality info like \"rendition.m3u8\")\n\n#### Step 2: Identify Required Headers\n\nMany CDNs require authentication headers:\n- **Referer**: Origin website (e.g., `https://maven.com/`)\n- **Origin**: Same as Referer for CORS\n- **User-Agent**: Browser identification\n\nCheck the Network tab to see which headers the browser sends.\n\n#### Step 3: Download with ffmpeg\n\nUse ffmpeg with the `-headers` flag for protected streams:\n\n```bash\nffmpeg -headers \"Referer: https://example.com/\" \\\n  -protocol_whitelist file,http,https,tcp,tls,crypto,httpproxy \\\n  -i \"https://cdn.example.com/path/rendition.m3u8?params\" \\\n  -c copy -bsf:a aac_adtstoasc \\\n  output.mp4\n```\n\n**Key parameters:**\n- `-headers`: Set HTTP headers (critical for authentication)\n- `-protocol_whitelist`: Enable required protocols for HLS\n- `-c copy`: Stream copy (no re-encoding, faster)\n- `-bsf:a aac_adtstoasc`: Fix AAC audio compatibility\n\n**Common header patterns:**\n```bash\n# Single header\n-headers \"Referer: https://example.com/\"\n\n# Multiple headers\n-headers \"Referer: https://example.com/\" \\\n-headers \"User-Agent: Mozilla/5.0...\"\n\n# Alternative syntax\n-headers $'Referer: https://example.com/\\r\\nUser-Agent: Mozilla/5.0...'\n```\n\n### Handling Separate Audio/Video Streams\n\nSome platforms (like Mux) deliver audio and video separately:\n\n1. **Download audio stream:**\n```bash\nffmpeg -headers \"Referer: https://example.com/\" \\\n  -protocol_whitelist file,http,https,tcp,tls,crypto,httpproxy \\\n  -i \"https://cdn.example.com/audio/rendition.m3u8\" \\\n  -c copy audio.m4a\n```\n\n2. **Download video stream:**\n```bash\nffmpeg -headers \"Referer: https://example.com/\" \\\n  -protocol_whitelist file,http,https,tcp,tls,crypto,httpproxy \\\n  -i \"https://cdn.example.com/video/rendition.m3u8\" \\\n  -c copy video.mp4\n```\n\n3. **Merge streams:**\n```bash\nffmpeg -i video.mp4 -i audio.m4a -c copy merged.mp4\n```\n\n### Troubleshooting HLS Downloads\n\n#### 403 Forbidden Errors\n\n**Cause**: Missing or incorrect authentication headers.\n\n**Solution**:\n1. Verify Referer header matches the video source website\n2. Check if additional headers (Origin, User-Agent) are needed\n3. Ensure the m3u8 URL includes all query parameters from browser\n\n#### yt-dlp Stuck on Cookie Extraction\n\n**Symptom**: `Extracting cookies from chrome` hangs indefinitely.\n\n**Solution**: Use ffmpeg directly instead of yt-dlp for HLS streams.\n\n#### Protocol Not Whitelisted\n\n**Error**: `Protocol 'https' not on whitelist 'file,crypto,data'`\n\n**Solution**: Add `-protocol_whitelist file,http,https,tcp,tls,crypto,httpproxy`\n\n#### Empty Segments or No Streams\n\n**Cause**: Expired signatures in the m3u8 URLs.\n\n**Solution**:\n1. Get fresh URLs from browser DevTools\n2. Download immediately after obtaining URLs\n3. Look for rendition URLs with updated signature parameters\n\n### Performance Tips\n\n- HLS downloads typically run at 10-15x realtime speed\n- No re-encoding with `-c copy` (fastest)\n- Monitor download with real-time progress display\n- Use absolute output paths to avoid directory confusion\n\n## Further Reading\n\n- **PO Token Setup**: See `references/po-token-setup.md` for detailed installation and troubleshooting\n- **yt-dlp Documentation**: https://github.com/yt-dlp/yt-dlp\n- **Format Selection Guide**: https://github.com/yt-dlp/yt-dlp#format-selection",
  "verticals": [
    "design"
  ],
  "tags": [],
  "author": {
    "name": "daymade",
    "github": "daymade"
  },
  "status": "ready",
  "verified": false,
  "visibility": "public",
  "license": "MIT",
  "links": {
    "repo": "https://github.com/daymade/claude-code-skills",
    "skill_md": "https://raw.githubusercontent.com/daymade/claude-code-skills/main/youtube-downloader/SKILL.md"
  },
  "stats": {
    "stars": 154,
    "forks": 13,
    "installs": 0
  },
  "last_updated": "2026-01-07T15:30:48Z",
  "created_at": "2025-10-22T11:17:31Z",
  "meta": {
    "source": "github",
    "sourceUrl": "https://github.com/daymade/claude-code-skills/blob/main/youtube-downloader/SKILL.md",
    "harvestedAt": "2026-01-07T16:59:54.890Z",
    "uniqueId": "sk_f7a09a0bba1f"
  }
}