{
  "id": "skills",
  "name": "worktree-manager",
  "version": "1.0.0",
  "summary": "Create, manage, and cleanup git worktrees with Claude Code agents across all projects. USE THIS SKILL when user says \"create worktree\", \"spin up worktrees\", \"new worktree for X\"...",
  "description": "# Global Worktree Manager\n\nManage parallel development across ALL projects using git worktrees with Claude Code agents. Each worktree is an isolated copy of the repo on a different branch, stored centrally at `~/tmp/worktrees/`.\n\n**IMPORTANT**: You (Claude) can perform ALL operations manually using standard tools (jq, git, bash). Scripts are helpers, not requirements. If a script fails, fall back to manual operations described in this document.\n\n## When This Skill Activates\n\n**Trigger phrases:**\n- \"spin up worktrees for X, Y, Z\"\n- \"create 3 worktrees for features A, B, C\"\n- \"new worktree for feature/auth\"\n- \"what's the status of my worktrees?\"\n- \"show all worktrees\" / \"show worktrees for this project\"\n- \"clean up merged worktrees\"\n- \"clean up the auth worktree\"\n- \"launch agent in worktree X\"\n- \"sync worktrees\" / \"sync worktree registry\"\n- \"create PR\" (when in a worktree - updates registry with PR number)\n\n---\n\n## File Locations\n\n| File | Purpose |\n|------|---------|\n| `~/.claude/worktree-registry.json` | **Global registry** - tracks all worktrees across all projects |\n| `~/.claude/skills/worktree-manager/config.json` | **Skill config** - terminal, shell, port range settings |\n| `~/.claude/skills/worktree-manager/scripts/` | **Helper scripts** - optional, can do everything manually |\n| `~/tmp/worktrees/` | **Worktree storage** - all worktrees live here |\n| `.claude/worktree.json` (per-project) | **Project config** - optional custom settings |\n\n---\n\n## Core Concepts\n\n### Centralized Worktree Storage\nAll worktrees live in `~/tmp/worktrees/<project-name>/<branch-slug>/`\n\n```\n~/tmp/worktrees/\n├── obsidian-ai-agent/\n│   ├── feature-auth/           # branch: feature/auth\n│   ├── feature-payments/       # branch: feature/payments\n│   └── fix-login-bug/          # branch: fix/login-bug\n└── another-project/\n    └── feature-dark-mode/\n```\n\n### Branch Slug Convention\nBranch names are slugified for filesystem safety by replacing `/` with `-`:\n- `feature/auth` → `feature-auth`\n- `fix/login-bug` → `fix-login-bug`\n- `feat/user-profile` → `feat-user-profile`\n\n**Slugify manually:** `echo \"feature/auth\" | tr '/' '-'` → `feature-auth`\n\n### Port Allocation Rules\n- **Global pool**: 8100-8199 (100 ports total)\n- **Per worktree**: 2 ports allocated (for API + frontend patterns)\n- **Globally unique**: Ports are tracked globally to avoid conflicts across projects\n- **Check before use**: Always verify port isn't in use by system: `lsof -i :<port>`\n\n---\n\n## Global Registry\n\n### Location\n`~/.claude/worktree-registry.json`\n\n### Schema\n```json\n{\n  \"worktrees\": [\n    {\n      \"id\": \"unique-uuid\",\n      \"project\": \"obsidian-ai-agent\",\n      \"repoPath\": \"/Users/rasmus/Projects/obsidian-ai-agent\",\n      \"branch\": \"feature/auth\",\n      \"branchSlug\": \"feature-auth\",\n      \"worktreePath\": \"/Users/rasmus/tmp/worktrees/obsidian-ai-agent/feature-auth\",\n      \"ports\": [8100, 8101],\n      \"createdAt\": \"2025-12-04T10:00:00Z\",\n      \"validatedAt\": \"2025-12-04T10:02:00Z\",\n      \"agentLaunchedAt\": \"2025-12-04T10:03:00Z\",\n      \"task\": \"Implement OAuth login\",\n      \"prNumber\": null,\n      \"status\": \"active\"\n    }\n  ],\n  \"portPool\": {\n    \"start\": 8100,\n    \"end\": 8199,\n    \"allocated\": [8100, 8101]\n  }\n}\n```\n\n### Field Descriptions\n\n**Worktree entry fields:**\n| Field | Type | Description |\n|-------|------|-------------|\n| `id` | string | Unique identifier (UUID) |\n| `project` | string | Project name (from git remote or directory) |\n| `repoPath` | string | Absolute path to original repository |\n| `branch` | string | Full branch name (e.g., `feature/auth`) |\n| `branchSlug` | string | Filesystem-safe name (e.g., `feature-auth`) |\n| `worktreePath` | string | Absolute path to worktree |\n| `ports` | number[] | Allocated port numbers (usually 2) |\n| `createdAt` | string | ISO 8601 timestamp |\n| `validatedAt` | string\\|null | When validation passed |\n| `agentLaunchedAt` | string\\|null | When agent was launched |\n| `task` | string\\|null | Task description for the agent |\n| `prNumber` | number\\|null | Associated PR number if exists |\n| `status` | string | `active`, `orphaned`, or `merged` |\n\n**Port pool fields:**\n| Field | Type | Description |\n|-------|------|-------------|\n| `start` | number | First port in pool (default: 8100) |\n| `end` | number | Last port in pool (default: 8199) |\n| `allocated` | number[] | Currently allocated ports |\n\n### Manual Registry Operations\n\n**Read entire registry:**\n```bash\ncat ~/.claude/worktree-registry.json | jq '.'\n```\n\n**List all worktrees:**\n```bash\ncat ~/.claude/worktree-registry.json | jq '.worktrees[]'\n```\n\n**List worktrees for specific project:**\n```bash\ncat ~/.claude/worktree-registry.json | jq '.worktrees[] | select(.project == \"my-project\")'\n```\n\n**Get allocated ports:**\n```bash\ncat ~/.claude/worktree-registry.json | jq '.portPool.allocated'\n```\n\n**Find worktree by branch (partial match):**\n```bash\ncat ~/.claude/worktree-registry.json | jq '.worktrees[] | select(.branch | contains(\"auth\"))'\n```\n\n**Add worktree entry manually:**\n```bash\nTMP=$(mktemp)\njq '.worktrees += [{\n  \"id\": \"'$(uuidgen)'\",\n  \"project\": \"my-project\",\n  \"repoPath\": \"/path/to/repo\",\n  \"branch\": \"feature/auth\",\n  \"branchSlug\": \"feature-auth\",\n  \"worktreePath\": \"/Users/me/tmp/worktrees/my-project/feature-auth\",\n  \"ports\": [8100, 8101],\n  \"createdAt\": \"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\",\n  \"validatedAt\": null,\n  \"agentLaunchedAt\": null,\n  \"task\": \"My task\",\n  \"prNumber\": null,\n  \"status\": \"active\"\n}]' ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n```\n\n**Add ports to allocated pool:**\n```bash\nTMP=$(mktemp)\njq '.portPool.allocated += [8100, 8101] | .portPool.allocated |= unique | .portPool.allocated |= sort_by(.)' \\\n  ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n```\n\n**Remove worktree entry:**\n```bash\nTMP=$(mktemp)\njq 'del(.worktrees[] | select(.project == \"my-project\" and .branch == \"feature/auth\"))' \\\n  ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n```\n\n**Release ports from pool:**\n```bash\nTMP=$(mktemp)\njq '.portPool.allocated = (.portPool.allocated | map(select(. != 8100 and . != 8101)))' \\\n  ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n```\n\n**Initialize empty registry (if missing):**\n```bash\nmkdir -p ~/.claude\ncat > ~/.claude/worktree-registry.json << 'EOF'\n{\n  \"worktrees\": [],\n  \"portPool\": {\n    \"start\": 8100,\n    \"end\": 8199,\n    \"allocated\": []\n  }\n}\nEOF\n```\n\n---\n\n## Manual Port Allocation\n\nIf `scripts/allocate-ports.sh` fails, allocate ports manually:\n\n**Step 1: Get currently allocated ports**\n```bash\nALLOCATED=$(cat ~/.claude/worktree-registry.json | jq -r '.portPool.allocated[]' | sort -n)\necho \"Currently allocated: $ALLOCATED\"\n```\n\n**Step 2: Find first available port (not in allocated list AND not in use by system)**\n```bash\nfor PORT in $(seq 8100 8199); do\n  # Check if in registry\n  if ! echo \"$ALLOCATED\" | grep -q \"^${PORT}$\"; then\n    # Check if in use by system\n    if ! lsof -i :\"$PORT\" &>/dev/null; then\n      echo \"Available: $PORT\"\n      break\n    fi\n  fi\ndone\n```\n\n**Step 3: Add to allocated pool**\n```bash\nTMP=$(mktemp)\njq '.portPool.allocated += [8100] | .portPool.allocated |= unique | .portPool.allocated |= sort_by(.)' \\\n  ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n```\n\n---\n\n## What You (Claude) Do vs What Scripts Do\n\n| Task | Script Available | Manual Fallback |\n|------|------------------|-----------------|\n| Determine project name | No | Parse `git remote get-url origin` or `basename $(pwd)` |\n| Detect package manager | No | Check for lockfiles (see Detection section) |\n| Create git worktree | No | `git worktree add <path> -b <branch>` |\n| Copy .agents/ directory | No | `cp -r .agents <worktree-path>/` |\n| Install dependencies | No | Run detected install command |\n| Validate (health check) | No | Start server, curl endpoint, stop server |\n| Allocate ports | `scripts/allocate-ports.sh 2` | Manual (see above) |\n| Register worktree | `scripts/register.sh` | Manual jq (see above) |\n| Launch agent in terminal | `scripts/launch-agent.sh` | Manual (see below) |\n| Show status | `scripts/status.sh` | `cat ~/.claude/worktree-registry.json \\| jq ...` |\n| Cleanup worktree | `scripts/cleanup.sh` | Manual (see Cleanup section) |\n\n---\n\n## Workflows\n\n### 1. Create Multiple Worktrees with Agents\n\n**User says:** \"Spin up 3 worktrees for feature/auth, feature/payments, and fix/login-bug\"\n\n**You do (can parallelize with subagents):**\n\n```\nFor EACH branch (can run in parallel):\n\n1. SETUP\n   a. Get project name:\n      PROJECT=$(basename $(git remote get-url origin 2>/dev/null | sed 's/\\.git$//') 2>/dev/null || basename $(pwd))\n   b. Get repo root:\n      REPO_ROOT=$(git rev-parse --show-toplevel)\n   c. Slugify branch:\n      BRANCH_SLUG=$(echo \"feature/auth\" | tr '/' '-')\n   d. Determine worktree path:\n      WORKTREE_PATH=~/tmp/worktrees/$PROJECT/$BRANCH_SLUG\n\n2. ALLOCATE PORTS\n   Option A (script): ~/.claude/skills/worktree-manager/scripts/allocate-ports.sh 2\n   Option B (manual): Find 2 unused ports from 8100-8199, add to registry\n\n3. CREATE WORKTREE\n   mkdir -p ~/tmp/worktrees/$PROJECT\n   git worktree add $WORKTREE_PATH -b $BRANCH\n   # If branch exists already, omit -b flag\n\n4. COPY UNCOMMITTED RESOURCES\n   cp -r .agents $WORKTREE_PATH/ 2>/dev/null || true\n   cp .env.example $WORKTREE_PATH/.env 2>/dev/null || true\n\n5. INSTALL DEPENDENCIES\n   cd $WORKTREE_PATH\n   # Detect and run: npm install / uv sync / etc.\n\n6. VALIDATE (start server, health check, stop)\n   a. Start server with allocated port\n   b. Wait and health check: curl -sf http://localhost:$PORT/health\n   c. Stop server\n   d. If FAILS: report error but continue with other worktrees\n\n7. REGISTER IN GLOBAL REGISTRY\n   Option A (script): ~/.claude/skills/worktree-manager/scripts/register.sh ...\n   Option B (manual): Update ~/.claude/worktree-registry.json with jq\n\n8. LAUNCH AGENT\n   Option A (script): ~/.claude/skills/worktree-manager/scripts/launch-agent.sh $WORKTREE_PATH \"task\"\n   Option B (manual): Open terminal manually, cd to path, run claude\n\nAFTER ALL COMPLETE:\n- Report summary table to user\n- Note any failures with details\n```\n\n### 2. Check Status\n\n**With script:**\n```bash\n~/.claude/skills/worktree-manager/scripts/status.sh\n~/.claude/skills/worktree-manager/scripts/status.sh --project my-project\n```\n\n**Manual:**\n```bash\n# All worktrees\ncat ~/.claude/worktree-registry.json | jq -r '.worktrees[] | \"\\(.project)\\t\\(.branch)\\t\\(.ports | join(\",\"))\\t\\(.status)\\t\\(.task // \"-\")\"'\n\n# For current project\nPROJECT=$(basename $(git remote get-url origin 2>/dev/null | sed 's/\\.git$//'))\ncat ~/.claude/worktree-registry.json | jq -r \".worktrees[] | select(.project == \\\"$PROJECT\\\") | \\\"\\(.branch)\\t\\(.ports | join(\\\",\\\"))\\t\\(.status)\\\"\"\n```\n\n### 3. Launch Agent Manually\n\nIf `launch-agent.sh` fails:\n\n**For Ghostty:**\n```bash\nopen -na \"Ghostty.app\" --args -e fish -c \"cd '$WORKTREE_PATH' && claude\"\n```\n\n**For iTerm2:**\n```bash\nosascript -e 'tell application \"iTerm2\" to create window with default profile' \\\n  -e 'tell application \"iTerm2\" to tell current session of current window to write text \"cd '\"$WORKTREE_PATH\"' && claude\"'\n```\n\n**For tmux:**\n```bash\ntmux new-session -d -s \"wt-$PROJECT-$BRANCH_SLUG\" -c \"$WORKTREE_PATH\" \"fish -c 'claude'\"\n```\n\n### 4. Cleanup Worktree\n\n**With script:**\n```bash\n~/.claude/skills/worktree-manager/scripts/cleanup.sh my-project feature/auth --delete-branch\n```\n\n**Manual cleanup:**\n```bash\n# 1. Get worktree info from registry\nENTRY=$(cat ~/.claude/worktree-registry.json | jq '.worktrees[] | select(.project == \"my-project\" and .branch == \"feature/auth\")')\nWORKTREE_PATH=$(echo \"$ENTRY\" | jq -r '.worktreePath')\nPORTS=$(echo \"$ENTRY\" | jq -r '.ports[]')\nREPO_PATH=$(echo \"$ENTRY\" | jq -r '.repoPath')\n\n# 2. Kill processes on ports\nfor PORT in $PORTS; do\n  lsof -ti:\"$PORT\" | xargs kill -9 2>/dev/null || true\ndone\n\n# 3. Remove worktree\ncd \"$REPO_PATH\"\ngit worktree remove \"$WORKTREE_PATH\" --force 2>/dev/null || rm -rf \"$WORKTREE_PATH\"\ngit worktree prune\n\n# 4. Remove from registry\nTMP=$(mktemp)\njq 'del(.worktrees[] | select(.project == \"my-project\" and .branch == \"feature/auth\"))' \\\n  ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n\n# 5. Release ports\nTMP=$(mktemp)\nfor PORT in $PORTS; do\n  jq \".portPool.allocated = (.portPool.allocated | map(select(. != $PORT)))\" \\\n    ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\ndone\n\n# 6. Optionally delete branch\ngit branch -D feature/auth\ngit push origin --delete feature/auth\n```\n\n### 5. Create PR from Worktree\n\nWhen creating a PR from a worktree branch, update the registry with the PR number:\n\n```bash\n# After gh pr create succeeds, get the PR number\nBRANCH=$(git branch --show-current)\nPR_NUM=$(gh pr view --json number -q '.number')\n\n# Update registry with PR number\nif [ -n \"$PR_NUM\" ] && [ -f ~/.claude/worktree-registry.json ]; then\n    TMP=$(mktemp)\n    jq \"(.worktrees[] | select(.branch == \\\"$BRANCH\\\")).prNumber = $PR_NUM\" \\\n      ~/.claude/worktree-registry.json > \"$TMP\" && mv \"$TMP\" ~/.claude/worktree-registry.json\n    echo \"Updated worktree registry with PR #$PR_NUM\"\nfi\n```\n\nThis enables `cleanup.sh --merged` to automatically find and clean up worktrees after their PRs are merged.\n\n### 6. Sync Registry\n\nReconcile registry with actual worktrees and PR status:\n\n```bash\n# Check status (no changes)\n~/.claude/skills/worktree-manager/scripts/sync.sh\n\n# Auto-fix issues (update PR numbers, remove missing entries)\n~/.claude/skills/worktree-manager/scripts/sync.sh --fix\n\n# Quiet mode (only show problems)\n~/.claude/skills/worktree-manager/scripts/sync.sh --quiet\n```\n\n---\n\n## Package Manager Detection\n\nDetect by checking for lockfiles in priority order:\n\n| File | Package Manager | Install Command |\n|------|-----------------|-----------------|\n| `bun.lockb` | bun | `bun install` |\n| `pnpm-lock.yaml` | pnpm | `pnpm install` |\n| `yarn.lock` | yarn | `yarn install` |\n| `package-lock.json` | npm | `npm install` |\n| `uv.lock` | uv | `uv sync` |\n| `pyproject.toml` (no uv.lock) | uv | `uv sync` |\n| `requirements.txt` | pip | `pip install -r requirements.txt` |\n| `go.mod` | go | `go mod download` |\n| `Cargo.toml` | cargo | `cargo build` |\n\n**Detection logic:**\n```bash\ncd $WORKTREE_PATH\nif [ -f \"bun.lockb\" ]; then bun install\nelif [ -f \"pnpm-lock.yaml\" ]; then pnpm install\nelif [ -f \"yarn.lock\" ]; then yarn install\nelif [ -f \"package-lock.json\" ]; then npm install\nelif [ -f \"uv.lock\" ]; then uv sync\nelif [ -f \"pyproject.toml\" ]; then uv sync\nelif [ -f \"requirements.txt\" ]; then pip install -r requirements.txt\nelif [ -f \"go.mod\" ]; then go mod download\nelif [ -f \"Cargo.toml\" ]; then cargo build\nfi\n```\n\n---\n\n## Dev Server Detection\n\nLook for dev commands in this order:\n\n1. **docker-compose.yml / compose.yml**: `docker-compose up -d` or `docker compose up -d`\n2. **package.json scripts**: Look for `dev`, `start:dev`, `serve`\n3. **Python with uvicorn**: `uv run uvicorn app.main:app --port $PORT`\n4. **Python with Flask**: `flask run --port $PORT`\n5. **Go**: `go run .`\n\n**Port injection**: Most servers accept `PORT` env var or `--port` flag\n\n---\n\n## Project-Specific Config (Optional)\n\nProjects can provide `.claude/worktree.json` for custom settings:\n\n```json\n{\n  \"ports\": {\n    \"count\": 2,\n    \"services\": [\"api\", \"frontend\"]\n  },\n  \"install\": \"uv sync && cd frontend && npm install\",\n  \"validate\": {\n    \"start\": \"docker-compose up -d\",\n    \"healthCheck\": \"curl -sf http://localhost:{{PORT}}/health\",\n    \"stop\": \"docker-compose down\"\n  },\n  \"copyDirs\": [\".agents\", \".env.example\", \"data/fixtures\"]\n}\n```\n\nIf this file exists, use its settings. Otherwise, auto-detect.\n\n---\n\n## Parallel Worktree Creation\n\nWhen creating multiple worktrees, use subagents for parallelization:\n\n```\nUser: \"Spin up worktrees for feature/a, feature/b, feature/c\"\n\nYou:\n1. Allocate ports for ALL worktrees upfront (6 ports total)\n2. Spawn 3 subagents, one per worktree\n3. Each subagent:\n   - Creates its worktree\n   - Installs deps\n   - Validates\n   - Registers (with its pre-allocated ports)\n   - Launches agent\n4. Collect results from all subagents\n5. Report unified summary with any failures noted\n```\n\n---\n\n## Safety Guidelines\n\n1. **Before cleanup**, check PR status:\n   - PR merged → safe to clean everything\n   - PR open → warn user, confirm before proceeding\n   - No PR → warn about unsubmitted work\n\n2. **Before deleting branches**, confirm if:\n   - PR not merged\n   - No PR exists\n   - Worktree has uncommitted changes\n\n3. **Port conflicts**: If port in use by non-worktree process, pick different port\n\n4. **Orphaned worktrees**: If original repo deleted, mark as `orphaned` in status\n\n5. **Max worktrees**: With 100-port pool and 2 ports each, max ~50 concurrent worktrees\n\n---\n\n## Script Reference\n\nScripts are in `~/.claude/skills/worktree-manager/scripts/`\n\n### allocate-ports.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/allocate-ports.sh <count>\n# Returns: space-separated port numbers (e.g., \"8100 8101\")\n# Automatically updates registry\n```\n\n### register.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/register.sh \\\n  <project> <branch> <branch-slug> <worktree-path> <repo-path> <ports> [task]\n# Example:\n~/.claude/skills/worktree-manager/scripts/register.sh \\\n  \"my-project\" \"feature/auth\" \"feature-auth\" \\\n  \"$HOME/tmp/worktrees/my-project/feature-auth\" \\\n  \"/path/to/repo\" \"8100,8101\" \"Implement OAuth\"\n```\n\n### launch-agent.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/launch-agent.sh <worktree-path> [task]\n# Opens new terminal window (Ghostty by default) with Claude Code\n```\n\n### status.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/status.sh [--project <name>]\n# Shows all worktrees, or filtered by project\n```\n\n### cleanup.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/cleanup.sh <project> <branch> [--delete-branch]\n# Kills ports, removes worktree, updates registry\n# --delete-branch also removes local and remote git branches\n\n# Or cleanup ALL merged worktrees at once:\n~/.claude/skills/worktree-manager/scripts/cleanup.sh --merged [--delete-branch]\n# Finds all worktrees with merged PRs and cleans them up\n```\n\n### sync.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/sync.sh [--quiet] [--fix]\n# Reconciles registry with actual worktrees and PR status\n# --quiet: Only show issues, not OK entries\n# --fix: Automatically remove missing entries and update PR numbers/status\n\n# Example: Check status without changing anything\n~/.claude/skills/worktree-manager/scripts/sync.sh\n\n# Example: Auto-fix registry issues\n~/.claude/skills/worktree-manager/scripts/sync.sh --fix\n```\n\n### release-ports.sh\n```bash\n~/.claude/skills/worktree-manager/scripts/release-ports.sh <port1> [port2] ...\n# Releases ports back to pool\n```\n\n---\n\n## Skill Config\n\nLocation: `~/.claude/skills/worktree-manager/config.json`\n\n```json\n{\n  \"terminal\": \"ghostty\",\n  \"shell\": \"fish\",\n  \"claudeCommand\": \"claude\",\n  \"portPool\": {\n    \"start\": 8100,\n    \"end\": 8199\n  },\n  \"portsPerWorktree\": 2,\n  \"worktreeBase\": \"~/tmp/worktrees\",\n  \"defaultCopyDirs\": [\".agents\", \".env.example\"]\n}\n```\n\n**Terminal options**: `ghostty`, `iterm2`, `tmux`, `wezterm`, `kitty`, `alacritty`\n\n---\n\n## Common Issues\n\n### \"Worktree already exists\"\n```bash\ngit worktree list\ngit worktree remove <path> --force\ngit worktree prune\n```\n\n### \"Branch already exists\"\n```bash\n# Use existing branch (omit -b flag)\ngit worktree add <path> <branch>\n```\n\n### \"Port already in use\"\n```bash\nlsof -i :<port>\n# Kill if stale, or pick different port\n```\n\n### Registry out of sync\n```bash\n# Compare registry to actual worktrees\ncat ~/.claude/worktree-registry.json | jq '.worktrees[].worktreePath'\nfind ~/tmp/worktrees -maxdepth 2 -type d\n\n# Remove orphaned entries or add missing ones\n```\n\n### Validation failed\n1. Check stderr/logs for error message\n2. Common issues: missing env vars, database not running, wrong port\n3. Report to user with details\n4. Continue with other worktrees\n5. User can fix and re-validate manually\n\n---\n\n## Example Session\n\n**User:** \"Spin up 2 worktrees for feature/dark-mode and fix/login-bug\"\n\n**You:**\n1. Detect project: `obsidian-ai-agent` (from git remote)\n2. Detect package manager: `uv` (found uv.lock)\n3. Allocate 4 ports: `~/.claude/skills/worktree-manager/scripts/allocate-ports.sh 4` → `8100 8101 8102 8103`\n4. Create worktrees:\n   ```bash\n   mkdir -p ~/tmp/worktrees/obsidian-ai-agent\n   git worktree add ~/tmp/worktrees/obsidian-ai-agent/feature-dark-mode -b feature/dark-mode\n   git worktree add ~/tmp/worktrees/obsidian-ai-agent/fix-login-bug -b fix/login-bug\n   ```\n5. Copy .agents/:\n   ```bash\n   cp -r .agents ~/tmp/worktrees/obsidian-ai-agent/feature-dark-mode/\n   cp -r .agents ~/tmp/worktrees/obsidian-ai-agent/fix-login-bug/\n   ```\n6. Install deps in each worktree:\n   ```bash\n   (cd ~/tmp/worktrees/obsidian-ai-agent/feature-dark-mode && uv sync)\n   (cd ~/tmp/worktrees/obsidian-ai-agent/fix-login-bug && uv sync)\n   ```\n7. Validate each (start server, health check, stop)\n8. Register both worktrees in `~/.claude/worktree-registry.json`\n9. Launch agents:\n   ```bash\n   ~/.claude/skills/worktree-manager/scripts/launch-agent.sh \\\n     ~/tmp/worktrees/obsidian-ai-agent/feature-dark-mode \"Implement dark mode toggle\"\n   ~/.claude/skills/worktree-manager/scripts/launch-agent.sh \\\n     ~/tmp/worktrees/obsidian-ai-agent/fix-login-bug \"Fix login redirect bug\"\n   ```\n10. Report:\n    ```\n    Created 2 worktrees with agents:\n\n    | Branch | Ports | Path | Task |\n    |--------|-------|------|------|\n    | feature/dark-mode | 8100, 8101 | ~/tmp/worktrees/.../feature-dark-mode | Implement dark mode |\n    | fix/login-bug | 8102, 8103 | ~/tmp/worktrees/.../fix-login-bug | Fix login redirect |\n\n    Both agents running in Ghostty windows.\n    ```",
  "verticals": [
    "engineering"
  ],
  "tags": [],
  "author": {
    "name": "Wirasm",
    "github": "Wirasm"
  },
  "status": "ready",
  "verified": false,
  "visibility": "public",
  "license": "MIT",
  "links": {
    "repo": "https://github.com/Wirasm/worktree-manager-skill",
    "skill_md": "https://raw.githubusercontent.com/Wirasm/worktree-manager-skill/main/.claude/skills/SKILL.md"
  },
  "stats": {
    "stars": 82,
    "forks": 23,
    "installs": 0
  },
  "last_updated": "2026-01-07T11:16:57Z",
  "created_at": "2025-12-05T11:08:02Z",
  "meta": {
    "source": "github",
    "sourceUrl": "https://github.com/Wirasm/worktree-manager-skill/blob/main/.claude/skills/SKILL.md",
    "harvestedAt": "2026-01-07T16:59:54.890Z",
    "uniqueId": "sk_29e600570ea0"
  }
}